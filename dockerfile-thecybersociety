# Build stage
FROM hugomods/hugo:exts-non-root as builder

WORKDIR /src

# Copy the entire project
COPY . .

# Verify theme installation
RUN ls -la themes/PaperMod || echo "Theme directory not found"

# Build the site with verbose output for debugging
RUN hugo --minify --verbose

# Production stage
FROM nginx:alpine

# Copy the built site
COPY --from=builder /src/public /usr/share/nginx/html

# Copy nginx configuration
COPY config/nginx/default.conf /etc/nginx/conf.d/default.conf

# Add labels for container metadata
LABEL org.opencontainers.image.source="https://github.com/vincentbenzo/thecybersociety"
LABEL org.opencontainers.image.description="The Cyber Society Blog - Professional Portfolio"
LABEL org.opencontainers.image.licenses="MIT"

# Verify the content was copied correctly
RUN ls -la /usr/share/nginx/html
