#####################################################################
#                            Build Stage                            #
#####################################################################
FROM hugomods/hugo:exts as builder

# Base URL
ARG HUGO_BASEURL=https://thecybersociety.io
ENV HUGO_BASEURL=${HUGO_BASEURL}

# Copy source
COPY . /src

# Debug: List contents
RUN ls -la /src && \
    echo "Theme directory contents:" && \
    ls -la /src/themes/ || echo "No themes directory"

# Build site with verbose output for debugging
RUN hugo --minify --enableGitInfo --verbose

#####################################################################
#                            Final Stage                            #
#####################################################################
FROM hugomods/hugo:nginx

# Copy the generated files
COPY --from=builder /src/public /site

# Copy custom nginx configuration if needed
COPY config/nginx/default.conf /etc/nginx/conf.d/default.conf

# Add labels for container metadata
LABEL org.opencontainers.image.source="https://github.com/vincentbenzo/thecybersociety"
LABEL org.opencontainers.image.description="The Cyber Society Blog - Professional Portfolio"
LABEL org.opencontainers.image.licenses="MIT"
