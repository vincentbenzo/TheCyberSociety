# Build stage
FROM hugomods/hugo:exts-non-root as builder

WORKDIR /src
COPY . .
# Initialize and update the theme submodule
RUN git init && \
    git submodule add https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod && \
    git submodule update --init --recursive && \
    hugo --minify


# Production stage
FROM nginx:alpine
COPY --from=builder /src/public /usr/share/nginx/html
COPY config/nginx/default.conf /etc/nginx/conf.d/default.conf

# Add labels for container metadata
LABEL org.opencontainers.image.source="https://github.com/vincentbenzo/thecybersociety"
LABEL org.opencontainers.image.description="The Cyber Society Blog - Professional Portfolio"
LABEL org.opencontainers.image.licenses="MIT"
