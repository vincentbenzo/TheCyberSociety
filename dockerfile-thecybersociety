# Build stage
FROM hugomods/hugo:exts-non-root as builder

WORKDIR /src

# Copy the entire project
COPY . .

# Debug: List contents and theme
RUN ls -la && \
    echo "Theme directory contents:" && \
    ls -la themes/ || echo "No themes directory"

# Verify hugo installation and version
RUN hugo version

# Initialize theme if not present
RUN if [ ! -d "themes/PaperMod" ]; then \
    git init && \
    git submodule add https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod; \
    fi

# Debug: List contents after theme initialization
RUN ls -la && \
    echo "Theme directory contents after init:" && \
    ls -la themes/

# Try building with extra verbose output
RUN hugo --minify --verbose --debug

# Production stage
FROM nginx:alpine

COPY --from=builder /src/public /usr/share/nginx/html
COPY config/nginx/default.conf /etc/nginx/conf.d/default.conf

# Add labels for container metadata
LABEL org.opencontainers.image.source="https://github.com/vincentbenzo/thecybersociety"
LABEL org.opencontainers.image.description="The Cyber Society Blog - Professional Portfolio"
LABEL org.opencontainers.image.licenses="MIT"
